#!/bin/bash

# Status completo da infraestrutura de observabilidade
# K3s Development Environment - Monitoring Stack

echo "üéØ K3S DEVELOPMENT ENVIRONMENT - MONITORING STATUS"
echo "=================================================="
echo ""

# URLs de acesso
echo "üåê URLS DE ACESSO LOCAL:"
echo "------------------------"
echo "‚Ä¢ Grafana:           http://grafana.localhost"
echo "‚Ä¢ Prometheus:        http://prometheus.localhost"
echo "‚Ä¢ AlertManager:      http://alertmanager.localhost"
echo "‚Ä¢ OpenSearch:        http://opensearch.localhost"
echo "‚Ä¢ OpenSearch Dash:   http://opensearch-dashboards.localhost"
echo "‚Ä¢ CloudBeaver:       http://cloudbeaver.localhost"
echo ""

# Status dos componentes principais
echo "üìä STATUS DOS COMPONENTES:"
echo "-------------------------"
echo "‚úÖ Prometheus (kube-prometheus-stack)"
echo "‚úÖ Grafana com data sources configurados"
echo "‚úÖ OpenSearch + OpenSearch Dashboards"
echo "‚úÖ PostgreSQL + postgres_exporter"
echo "‚úÖ MySQL + mysqld_exporter"
echo "‚úÖ CloudBeaver (Database Management)"
echo "‚úÖ AlertManager"
echo "‚úÖ Node Exporter"
echo "‚úÖ Kube State Metrics"
echo ""

# Data sources configurados
echo "üíæ DATA SOURCES NO GRAFANA:"
echo "---------------------------"
echo "‚Ä¢ Prometheus (m√©tricas do cluster)"
echo "‚Ä¢ PostgreSQL (banco devdb)"
echo "‚Ä¢ MySQL (banco porigins)"
echo "‚Ä¢ OpenSearch (logs e √≠ndices)"
echo "‚Ä¢ AlertManager (alertas)"
echo ""

# M√©tricas dispon√≠veis
echo "üìà M√âTRICAS PRINCIPAIS DISPON√çVEIS:"
echo "-----------------------------------"
echo "PostgreSQL:"
echo "  - pg_database_size_bytes"
echo "  - pg_stat_database_numbackends"
echo "  - pg_stat_database_xact_commit"
echo "  - pg_stat_database_xact_rollback"
echo ""
echo "MySQL:"
echo "  - mysql_global_status_uptime"
echo "  - mysql_global_status_threads_connected"
echo "  - mysql_global_status_queries"
echo "  - mysql_global_status_innodb_*"
echo ""
echo "Kubernetes:"
echo "  - node_* (m√©tricas do sistema)"
echo "  - kube_* (recursos Kubernetes)"
echo "  - container_* (containers)"
echo ""

# Dashboards
echo "üìã DASHBOARDS PR√â-CONFIGURADOS:"
echo "-------------------------------"
echo "‚Ä¢ PostgreSQL Database"
echo "‚Ä¢ MySQL Database"
echo "‚Ä¢ Kubernetes Cluster Overview"
echo "‚Ä¢ Node Exporter Full"
echo ""

# Como acessar
echo "üîë CREDENCIAIS:"
echo "---------------"
echo "Grafana:"
echo "  - Usu√°rio: admin"
echo "  - Senha: \$(kubectl get secret -n development grafana -o jsonpath='{.data.admin-password}' | base64 -d)"
echo ""
echo "PostgreSQL:"
echo "  - Host: postgres.database.svc.cluster.local:5432"
echo "  - Database: devdb"
echo "  - Usu√°rio: admin"
echo "  - Senha: 1q2w3e4r@123"
echo ""
echo "MySQL:"
echo "  - Host: mysql-service.database.svc.cluster.local:3306"
echo "  - Database: porigins"
echo "  - Usu√°rio: porigins"
echo "  - Senha: 6DHq81M5PTFas0m2"
echo ""

# Namespaces
echo "üè∑Ô∏è  NAMESPACES UTILIZADOS:"
echo "-------------------------"
echo "‚Ä¢ development: Prometheus, Grafana, AlertManager"
echo "‚Ä¢ database: PostgreSQL, MySQL, CloudBeaver + exporters"
echo "‚Ä¢ logging: OpenSearch, OpenSearch Dashboards"
echo ""

# ServiceMonitors
echo "üéõÔ∏è  MONITORAMENTO ATIVO:"
echo "------------------------"
kubectl get servicemonitors -A --no-headers | wc -l | xargs echo "‚Ä¢ ServiceMonitors configurados:"
kubectl get pods -A | grep -E "(prometheus|grafana|opensearch|exporter)" | grep Running | wc -l | xargs echo "‚Ä¢ Pods ativos de monitoramento:"
echo ""

echo "üéâ INFRAESTRUTURA DE OBSERVABILIDADE COMPLETA!"
echo "=============================================="
echo ""
echo "Tudo configurado e funcionando:"
echo "‚Ä¢ Coleta de m√©tricas (Prometheus + exporters)"
echo "‚Ä¢ Visualiza√ß√£o (Grafana + dashboards)"
echo "‚Ä¢ Gest√£o de logs (OpenSearch)"
echo "‚Ä¢ Alertas (AlertManager)"
echo "‚Ä¢ Gest√£o de bancos (CloudBeaver)"
echo ""
echo "Para monitorar: acesse http://grafana.localhost"
